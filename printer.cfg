# Modified by Simple AF 2025-06-18_00-28-39
# K1
# Printer_size: 220x220x250
# Version: v1.0.25
# CreateDate: 2023/03/21
# Nozzle_mcu: chip: GD32F303CBT6
#             version: CR-K1-MAX-NOZZLE-V1.0.0
# Leveling_mcu: chip: GD32E230F8P6
#             version: CR-K1-MAX-LEVELING-V1.0.0
# mcu: chip: GD32F303RET6
#      version: CR4CU220812S12

[include sensorless.cfg]
[include internal_macros.cfg]

[include useful_macros.cfg]

[include belts_calibration.cfg]

[include start_end.cfg]

[include Line_Purge.cfg]

[include Smart_Park.cfg]

[include fan_control.cfg]

[include client.cfg]

[include quickstart.cfg]

[include btteddy.cfg]

[include btteddy_macro.cfg]

[include timelapse.cfg]

[mcu]
serial: /dev/ttyS7
baud: 230400
restart_method: command

[mcu nozzle_mcu]
serial: /dev/ttyS1
baud: 230400
restart_method: command

[verify_heater extruder]
[verify_heater heater_bed]
check_gain_time: 120
heating_gain: 1.0
hysteresis: 10

[gcode_arcs]
resolution: 1.0

[stepper_x]
step_pin: PC2
dir_pin: !PB9
enable_pin: !PC3
microsteps: 32
rotation_distance: 72
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_endstop: 229
position_min: -5
position_max: 229
homing_speed: 36
homing_retract_dist:0

[tmc2209 stepper_x]
uart_pin:PA9
interpolate: False
run_current:1.5
sense_resistor: 0.100
stealthchop_threshold: 0
uart_address:3
diag_pin: ^PB12
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 0
# driver_HSTRT: 7
driver_SGTHRS: 65
# hold_current:1.0

[stepper_y]
step_pin: PB8
dir_pin: !PB7
enable_pin: !PC3
microsteps: 32
rotation_distance: 72
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_endstop: -0.5
position_min: -0.5
position_max: 226
homing_speed: 36
homing_retract_dist:0

[tmc2209 stepper_y]
uart_pin:PA10
interpolate: False
run_current:1.5
sense_resistor: 0.100
stealthchop_threshold: 0
uart_address:3
diag_pin: ^PB13
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 0
# driver_HSTRT: 7
driver_SGTHRS: 65
# hold_current:1.0

[stepper_z]
step_pin: PB6
dir_pin: !PB5
enable_pin: !PC3
microsteps: 16
rotation_distance:8
gear_ratio: 64:20
endstop_pin: probe:z_virtual_endstop
position_max: 255
position_min: -5
# position_endstop: 0

[tmc2209 stepper_z]
uart_pin: PA11
uart_address: 3
run_current: 0.8
diag_pin: ^PB14
stealthchop_threshold: 0
sense_resistor: 0.100
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 2
# driver_HSTRT: 2
driver_SGTHRS: 0

[extruder]
max_extrude_only_distance: 1000.0
max_extrude_cross_section: 80
step_pin: nozzle_mcu:PB1
dir_pin: nozzle_mcu:PB0
enable_pin: !nozzle_mcu:PB2
microsteps: 16
rotation_distance: 6.798
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: nozzle_mcu:PB7
sensor_type: EPCOS 100K B57560G104F
sensor_pin: nozzle_mcu:PA0
pressure_advance: 0.035
pressure_advance_smooth_time: 0.040
min_temp: 0
max_temp: 320
# control: pid
# pid_Kp: 25.013
# pid_Ki: 2.566
# pid_Kd: 60.966

[tmc2209 extruder]
uart_pin: nozzle_mcu:PB11
tx_pin: nozzle_mcu:PB10
uart_address: 3
run_current: 0.55
sense_resistor: 0.150
stealthchop_threshold: 0
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 2
# driver_TOFF: 3
# driver_HEND: 0
# driver_HSTRT: 5

[heater_bed]
heater_pin: PB10
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PC4
# control: pid
# pid_kp: 27
# pid_ki: 0.08
# pid_kd: 0
min_temp: 0
max_temp: 115
# control: watermark

[filament_switch_sensor filament_sensor]
pause_on_runout: true
switch_pin: !PC15
runout_gcode: _ON_FILAMENT_RUNOUT

[output_pin LED]
pin:PB0
pwm: True
cycle_time: 0.010
value: 1

[adxl345]
cs_pin: nozzle_mcu:PA4
spi_speed: 5000000
axes_map: x,-z,y
spi_software_sclk_pin: nozzle_mcu:PA5
spi_software_mosi_pin: nozzle_mcu:PA7
spi_software_miso_pin: nozzle_mcu:PA6

[resonance_tester]
accel_chip: adxl345
accel_per_hz: 75
# min_freq: 30
# max_freq: 100
probe_points:
   110,110,10

[printer]
kinematics: corexy
max_velocity: 800
max_accel: 20000
max_z_velocity: 20
square_corner_velocity: 5.0
max_z_accel: 300
# square_corner_max_velocity: 200.0
# max_accel_to_decel: 20000

[probe_eddy_current btt_eddy]

[filament_switch_sensor filament_sensor_2]
pause_on_runout: true
switch_pin: !nozzle_mcu:PA10


[exclude_object]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3235495.378,0.089844:3234392.561,0.129687:3233312.856,
#*# 	0.170312:3232194.931,0.210156:3231130.213,0.250000:3230049.294,
#*# 	0.289844:3229008.749,0.329687:3227982.960,0.370312:3226920.990,
#*# 	0.410156:3225872.794,0.450000:3224875.215,0.489844:3223913.939,
#*# 	0.529687:3222923.391,0.570312:3221949.164,0.610156:3221025.409,
#*# 	0.650000:3220091.166,0.689844:3219176.650,0.729687:3218274.459,
#*# 	0.770312:3217384.251,0.810156:3216505.652,0.850000:3215659.393,
#*# 	0.889844:3214813.542,0.929687:3214045.739,0.970312:3213200.606,
#*# 	1.010156:3212399.583,1.050000:3211632.838,1.089844:3210865.848,
#*# 	1.129687:3210127.190,1.170312:3209336.954,1.210156:3208600.586,
#*# 	1.250000:3207906.416,1.289844:3207221.506,1.329687:3206526.269,
#*# 	1.370312:3205824.455,1.410156:3205163.480,1.450000:3204537.651,
#*# 	1.489844:3203853.584,1.529687:3203237.714,1.570312:3202606.317,
#*# 	1.610156:3201981.080,1.650000:3201396.482,1.689844:3200814.530,
#*# 	1.729687:3200242.277,1.770312:3199627.992,1.810156:3199062.332,
#*# 	1.850000:3198542.808,1.889844:3197991.740,1.929687:3197493.730,
#*# 	1.970312:3196977.513,2.010156:3196466.929,2.050000:3195970.446,
#*# 	2.089844:3195485.458,2.129687:3195015.045,2.170312:3194557.695,
#*# 	2.210156:3194115.350,2.250000:3193664.748,2.289844:3193221.457,
#*# 	2.329687:3192811.886,2.370312:3192380.338,2.410156:3191962.226,
#*# 	2.450000:3191551.809,2.489844:3191172.750,2.529687:3190772.243,
#*# 	2.570312:3190391.777,2.610156:3190007.889,2.650000:3189615.380,
#*# 	2.689844:3189260.185,2.729687:3188910.801,2.770312:3188544.468,
#*# 	2.810156:3188190.052,2.850000:3187885.525,2.889844:3187548.617,
#*# 	2.929687:3187194.454,2.970312:3186869.761,3.010156:3186523.638,
#*# 	3.050000:3186208.174,3.089844:3185914.775,3.129687:3185633.876,
#*# 	3.170312:3185294.574,3.210156:3185007.185,3.250000:3184742.831,
#*# 	3.289844:3184466.246,3.329687:3184190.948,3.370312:3183908.476,
#*# 	3.410156:3183658.190,3.450000:3183392.887,3.489844:3183143.962,
#*# 	3.529687:3182896.678,3.570312:3182630.358,3.610156:3182375.506,
#*# 	3.650000:3182145.104,3.689844:3181902.990,3.729687:3181658.272,
#*# 	3.770312:3181435.098,3.810156:3181210.263,3.850000:3180979.144,
#*# 	3.889844:3180760.880,3.929687:3180575.652,3.970312:3180348.212,
#*# 	4.010156:3180144.634,4.050000:3179954.646
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 21.777
#*# pid_ki = 1.241
#*# pid_kd = 95.545
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 59.346
#*# pid_ki = 0.603
#*# pid_kd = 1459.907
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 58.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 55.6
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 33.237035
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.187972, -0.184463, -0.195006, -0.190363, -0.185758, -0.190004, -0.186855, -0.188889, -0.180037, -0.174839, -0.169507, -0.166966, -0.158582, -0.152939, -0.146393, -0.137099, -0.139653, -0.124761, -0.104971, -0.086830
#*# 	  -0.151680, -0.167876, -0.173921, -0.171530, -0.176690, -0.170612, -0.166404, -0.164435, -0.164967, -0.159859, -0.148380, -0.139086, -0.125116, -0.116084, -0.112211, -0.104277, -0.105141, -0.097510, -0.089536, -0.068471
#*# 	  -0.119028, -0.128230, -0.130536, -0.127366, -0.121124, -0.126672, -0.125979, -0.130537, -0.133269, -0.128416, -0.122327, -0.120939, -0.110182, -0.108608, -0.103770, -0.097496, -0.100624, -0.088414, -0.072852, -0.049290
#*# 	  -0.084647, -0.091777, -0.096988, -0.094567, -0.095260, -0.097497, -0.104632, -0.107576, -0.109827, -0.109149, -0.102876, -0.095247, -0.082793, -0.074363, -0.064256, -0.064434, -0.060398, -0.058200, -0.046984, -0.035797
#*# 	  -0.049770, -0.059547, -0.058022, -0.060329, -0.058873, -0.066439, -0.068635, -0.077726, -0.083453, -0.081942, -0.078921, -0.075379, -0.074198, -0.070669, -0.065602, -0.058708, -0.057032, -0.044678, -0.030860, -0.011114
#*# 	  -0.021818, -0.032659, -0.034147, -0.034643, -0.039253, -0.041886, -0.044516, -0.050278, -0.053147, -0.055331, -0.050278, -0.047965, -0.043512, -0.032659, -0.024320, -0.023940, -0.022786, -0.014068, -0.003082, 0.009715
#*# 	  0.010511, 0.007315, -0.000042, 0.001560, -0.000524, -0.004528, -0.009653, -0.014897, -0.018507, -0.020168, -0.018347, -0.019500, -0.026085, -0.019834, -0.016720, -0.010771, -0.009495, 0.002200, 0.017397, 0.039235
#*# 	  0.031646, 0.023948, 0.014672, 0.012911, 0.009557, 0.004590, 0.005554, -0.000033, -0.004371, -0.004100, -0.002611, -0.001488, 0.005554, 0.012113, 0.018518, 0.022835, 0.026830, 0.025875, 0.041439, 0.056017
#*# 	  0.043915, 0.037625, 0.032945, 0.032182, 0.028913, 0.025235, 0.020269, 0.018508, 0.016443, 0.011151, 0.012754, 0.009391, 0.012764, 0.016433, 0.021075, 0.027960, 0.029879, 0.036981, 0.055857, 0.078410
#*# 	  0.070704, 0.064567, 0.060054, 0.054082, 0.049188, 0.047467, 0.044075, 0.042944, 0.041328, 0.044560, 0.045681, 0.045849, 0.056176, 0.065698, 0.066184, 0.075957, 0.080385, 0.081041, 0.092031, 0.108761
#*# 	  0.097283, 0.084481, 0.080878, 0.074315, 0.082683, 0.079891, 0.078093, 0.072348, 0.074641, 0.077429, 0.076450, 0.072509, 0.073165, 0.075795, 0.084974, 0.086287, 0.084480, 0.097769, 0.115414, 0.136318
#*# 	  0.113049, 0.104497, 0.101218, 0.100724, 0.101055, 0.100725, 0.104990, 0.102205, 0.102691, 0.102854, 0.111118, 0.115273, 0.116604, 0.124314, 0.131132, 0.133355, 0.132318, 0.135280, 0.151053, 0.162535
#*# 	  0.150586, 0.145507, 0.144326, 0.147735, 0.148181, 0.148627, 0.146849, 0.146101, 0.145664, 0.146551, 0.148324, 0.148774, 0.145511, 0.151060, 0.155304, 0.157822, 0.157817, 0.166939, 0.180778, 0.202310
#*# 	  0.190180, 0.176687, 0.174173, 0.175430, 0.174801, 0.175113, 0.173543, 0.175114, 0.176059, 0.174173, 0.180935, 0.187221, 0.192203, 0.198991, 0.202169, 0.204479, 0.201736, 0.209101, 0.215453, 0.225852
#*# 	  0.217909, 0.212421, 0.211410, 0.212712, 0.212999, 0.211122, 0.204622, 0.205633, 0.205922, 0.203899, 0.208088, 0.206789, 0.206932, 0.211990, 0.214874, 0.215886, 0.213866, 0.221231, 0.233680, 0.251578
#*# 	  0.254019, 0.242358, 0.237341, 0.237476, 0.239510, 0.238425, 0.238019, 0.234901, 0.236527, 0.236753, 0.241544, 0.245883, 0.247918, 0.251850, 0.257002, 0.262290, 0.265545, 0.264596, 0.272716, 0.279711
#*# 	  0.290752, 0.288990, 0.286277, 0.281805, 0.283708, 0.282279, 0.282567, 0.274714, 0.274288, 0.274571, 0.277568, 0.277140, 0.279139, 0.281425, 0.285991, 0.287419, 0.286991, 0.295272, 0.304550, 0.321629
#*# 	  0.331875, 0.323314, 0.313344, 0.305122, 0.311663, 0.308261, 0.309831, 0.310539, 0.304835, 0.309832, 0.310959, 0.319664, 0.320643, 0.323172, 0.327804, 0.326261, 0.332158, 0.336368, 0.345070, 0.350404
#*# 	  0.365913, 0.358228, 0.348161, 0.343810, 0.344929, 0.341983, 0.342682, 0.338333, 0.338471, 0.334962, 0.331878, 0.333559, 0.330052, 0.336931, 0.340859, 0.338753, 0.338753, 0.350685, 0.361396, 0.375138
#*# 	  0.407716, 0.403010, 0.387433, 0.384218, 0.384782, 0.380585, 0.389533, 0.394124, 0.386873, 0.374443, 0.377093, 0.380444, 0.387020, 0.387991, 0.395819, 0.390595, 0.392555, 0.393468, 0.398956, 0.416464
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 189.99
#*# min_y = 15.0
#*# max_y = 210.89000000000004
