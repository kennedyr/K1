# Modified by Simple AF 2025-06-18_00-28-39
# K1
# Printer_size: 220x220x250
# Version: v1.0.25
# CreateDate: 2023/03/21
# Nozzle_mcu: chip: GD32F303CBT6
#             version: CR-K1-MAX-NOZZLE-V1.0.0
# Leveling_mcu: chip: GD32E230F8P6
#             version: CR-K1-MAX-LEVELING-V1.0.0
# mcu: chip: GD32F303RET6
#      version: CR4CU220812S12

[include sensorless.cfg]
[include internal_macros.cfg]

[include useful_macros.cfg]

[include belts_calibration.cfg]

[include start_end.cfg]

[include Line_Purge.cfg]

[include Smart_Park.cfg]

[include fan_control.cfg]

[include client.cfg]

[include quickstart.cfg]

[include btteddy.cfg]

[include btteddy_macro.cfg]

[include timelapse.cfg]

[mcu]
serial: /dev/ttyS7
baud: 230400
restart_method: command

[mcu nozzle_mcu]
serial: /dev/ttyS1
baud: 230400
restart_method: command

[verify_heater extruder]
[verify_heater heater_bed]
check_gain_time: 120
heating_gain: 1.0
hysteresis: 10

[gcode_arcs]
resolution: 1.0

[stepper_x]
step_pin: PC2
dir_pin: !PB9
enable_pin: !PC3
microsteps: 64
rotation_distance: 72
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_endstop: 229
position_min: -5
position_max: 229
homing_speed: 36
homing_retract_dist:0

[tmc2209 stepper_x]
uart_pin:PA9
interpolate: False
run_current:1.5
sense_resistor: 0.100
stealthchop_threshold: 0
uart_address:3
diag_pin: ^PB12
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 0
# driver_HSTRT: 7
driver_SGTHRS: 65
# hold_current:1.0

[stepper_y]
step_pin: PB8
dir_pin: !PB7
enable_pin: !PC3
microsteps: 64
rotation_distance: 72
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_endstop: -0.5
position_min: -0.5
position_max: 226
homing_speed: 36
homing_retract_dist:0

[tmc2209 stepper_y]
uart_pin:PA10
interpolate: False
run_current:1.5
sense_resistor: 0.100
stealthchop_threshold: 0
uart_address:3
diag_pin: ^PB13
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 0
# driver_HSTRT: 7
driver_SGTHRS: 65
# hold_current:1.0

[stepper_z]
step_pin: PB6
dir_pin: !PB5
enable_pin: !PC3
microsteps: 16
rotation_distance:8
gear_ratio: 64:20
endstop_pin: probe:z_virtual_endstop
position_max: 255
position_min: 0

[tmc2209 stepper_z]
uart_pin: PA11
uart_address: 3
run_current: 0.8
diag_pin: ^PB14
stealthchop_threshold: 0
sense_resistor: 0.100
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 2
# driver_HSTRT: 2
driver_SGTHRS: 0

[extruder]
max_extrude_only_distance: 1000.0
max_extrude_cross_section: 80
step_pin: nozzle_mcu:PB1
dir_pin: nozzle_mcu:PB0
enable_pin: !nozzle_mcu:PB2
microsteps: 16
rotation_distance: 6.798
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: nozzle_mcu:PB7
sensor_type: EPCOS 100K B57560G104F
sensor_pin: nozzle_mcu:PA0
pressure_advance: 0.035
pressure_advance_smooth_time: 0.040
min_temp: 0
max_temp: 320

[tmc2209 extruder]
uart_pin: nozzle_mcu:PB11
tx_pin: nozzle_mcu:PB10
uart_address: 3
run_current: 0.55
sense_resistor: 0.150
stealthchop_threshold: 0
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 2
# driver_TOFF: 3
# driver_HEND: 0
# driver_HSTRT: 5

[heater_bed]
heater_pin: PB10
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PC4
min_temp: 0
max_temp: 115

[filament_switch_sensor filament_sensor]
pause_on_runout: true
switch_pin: !PC15
runout_gcode: _ON_FILAMENT_RUNOUT

[output_pin LED]
pin:PB0
pwm: True
cycle_time: 0.010
value: 1

[adxl345]
cs_pin: nozzle_mcu:PA4
spi_speed: 5000000
axes_map: x,-z,y
spi_software_sclk_pin: nozzle_mcu:PA5
spi_software_mosi_pin: nozzle_mcu:PA7
spi_software_miso_pin: nozzle_mcu:PA6

[resonance_tester]
accel_chip: adxl345
accel_per_hz: 75
# min_freq: 30
# max_freq: 100
probe_points:
   110,110,10

[printer]
kinematics: corexy
max_velocity: 800
max_accel: 20000
max_z_velocity: 20
square_corner_velocity: 5.0
max_z_accel: 300
# square_corner_max_velocity: 200.0
# max_accel_to_decel: 20000

[probe_eddy_current btt_eddy]

[filament_switch_sensor filament_sensor_2]
pause_on_runout: true
switch_pin: !nozzle_mcu:PA10


[exclude_object]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3230012.389,0.089844:3228941.700,0.129687:3227890.032,
#*# 	0.170312:3226823.913,0.210156:3225849.627,0.250000:3224785.710,
#*# 	0.289844:3223825.956,0.329687:3222815.432,0.370312:3221889.623,
#*# 	0.410156:3220920.416,0.450000:3219991.300,0.489844:3219065.495,
#*# 	0.529687:3218217.444,0.570312:3217344.203,0.610156:3216484.653,
#*# 	0.650000:3215624.430,0.689844:3214773.668,0.729687:3213973.605,
#*# 	0.770312:3213158.423,0.810156:3212352.732,0.850000:3211566.491,
#*# 	0.889844:3210788.906,0.929687:3210055.398,0.970312:3209305.712,
#*# 	1.010156:3208575.362,1.050000:3207856.822,1.089844:3207148.470,
#*# 	1.129687:3206479.603,1.170312:3205815.305,1.210156:3205165.470,
#*# 	1.250000:3204496.889,1.289844:3203876.229,1.329687:3203232.556,
#*# 	1.370312:3202620.111,1.410156:3202025.667,1.450000:3201431.453,
#*# 	1.489844:3200839.804,1.529687:3200283.960,1.570312:3199698.526,
#*# 	1.610156:3199163.150,1.650000:3198605.146,1.689844:3198078.498,
#*# 	1.729687:3197562.904,1.770312:3197033.226,1.810156:3196591.938,
#*# 	1.850000:3196067.883,1.889844:3195603.822,1.929687:3195139.456,
#*# 	1.970312:3194663.614,2.010156:3194216.795,2.050000:3193748.349,
#*# 	2.089844:3193291.122,2.129687:3192897.736,2.170312:3192464.810,
#*# 	2.210156:3192037.161,2.250000:3191625.352,2.289844:3191224.303,
#*# 	2.329687:3190842.631,2.370312:3190460.611,2.410156:3190052.800,
#*# 	2.450000:3189702.645,2.489844:3189340.290,2.529687:3188981.345,
#*# 	2.570312:3188647.129,2.610156:3188276.881,2.650000:3187946.861,
#*# 	2.689844:3187603.399,2.729687:3187293.628,2.770312:3186961.799,
#*# 	2.810156:3186643.040,2.850000:3186327.562,2.889844:3186037.075,
#*# 	2.929687:3185724.968,2.970312:3185429.256,3.010156:3185154.229,
#*# 	3.050000:3184872.290,3.089844:3184605.862,3.129687:3184325.808,
#*# 	3.170312:3184042.520,3.210156:3183812.380,3.250000:3183529.152,
#*# 	3.289844:3183273.256,3.329687:3183037.067,3.370312:3182769.280,
#*# 	3.410156:3182542.884,3.450000:3182327.289,3.489844:3182075.744,
#*# 	3.529687:3181832.546,3.570312:3181627.486,3.610156:3181402.080,
#*# 	3.650000:3181166.839,3.689844:3180949.727,3.729687:3180756.044,
#*# 	3.770312:3180550.298,3.810156:3180355.568,3.850000:3180135.196,
#*# 	3.889844:3179928.999,3.929687:3179743.048,3.970312:3179535.767,
#*# 	4.010156:3179349.010,4.050000:3179181.464
#*# z_offset = 0.644
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 21.777
#*# pid_ki = 1.241
#*# pid_kd = 95.545
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 59.346
#*# pid_ki = 0.603
#*# pid_kd = 1459.907
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 45.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 39.4
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 35.128377
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.050376, 0.040648, 0.026933, 0.025968, 0.020062, 0.022257, 0.022534, 0.022396, 0.025556, 0.027894, 0.029677, 0.038845, 0.038979, 0.039817, 0.045928, 0.055835, 0.068708, 0.089237, 0.126705, 0.163698
#*# 	0.035370, 0.024872, 0.017730, 0.013466, 0.011271, 0.012144, 0.016081, 0.018824, 0.024045, 0.031066, 0.038290, 0.044910, 0.051348, 0.060929, 0.068849, 0.075328, 0.086636, 0.095600, 0.117873, 0.138984
#*# 	0.037317, 0.030236, 0.021163, 0.018962, 0.021023, 0.021163, 0.019235, 0.013419, 0.014981, 0.016214, 0.021712, 0.026516, 0.028438, 0.029354, 0.031200, 0.039676, 0.054128, 0.070651, 0.095607, 0.126012
#*# 	0.039541, 0.028716, 0.024871, 0.023907, 0.022401, 0.020202, 0.020884, 0.016080, 0.014570, 0.013885, 0.022812, 0.029404, 0.031478, 0.043153, 0.049399, 0.056903, 0.072087, 0.077278, 0.095087, 0.117048
#*# 	0.055930, 0.049124, 0.041761, 0.040788, 0.035368, 0.041764, 0.032179, 0.024045, 0.011825, 0.010311, 0.015120, 0.019284, 0.016080, 0.014020, 0.018691, 0.027889, 0.040507, 0.052600, 0.080530, 0.108725
#*# 	0.066350, 0.053847, 0.050511, 0.042732, 0.037874, 0.038014, 0.027066, 0.019379, 0.017591, 0.006877, 0.009350, 0.021305, 0.022946, 0.032594, 0.039817, 0.046017, 0.053292, 0.070778, 0.082223, 0.097292
#*# 	0.076500, 0.069264, 0.063985, 0.059542, 0.055375, 0.053010, 0.045378, 0.033706, 0.022946, 0.018552, 0.014297, 0.013471, 0.013609, 0.014431, 0.018557, 0.021163, 0.037036, 0.053432, 0.080267, 0.099887
#*# 	0.076375, 0.062604, 0.056347, 0.053298, 0.044406, 0.039957, 0.030464, 0.024871, 0.024184, 0.018002, 0.018140, 0.019375, 0.028258, 0.036897, 0.041204, 0.048708, 0.054679, 0.070517, 0.086247, 0.102100
#*# 	0.065103, 0.059542, 0.047596, 0.039816, 0.035651, 0.029405, 0.022811, 0.019512, 0.013608, 0.006323, 0.005912, 0.007565, 0.005916, 0.009205, 0.010582, 0.015803, 0.025837, 0.042176, 0.073899, 0.108081
#*# 	0.066906, 0.050785, 0.044822, 0.034718, 0.030236, 0.024184, 0.021983, 0.014846, 0.014293, 0.008110, 0.010583, 0.017863, 0.028171, 0.035790, 0.043709, 0.046899, 0.052594, 0.065103, 0.088842, 0.111936
#*# 	0.092485, 0.061351, 0.054396, 0.048983, 0.043564, 0.039126, 0.035374, 0.030371, 0.024595, 0.017083, 0.014426, 0.020479, 0.024600, 0.020335, 0.023496, 0.025510, 0.036200, 0.058008, 0.084555, 0.103229
#*# 	0.072469, 0.053010, 0.039677, 0.035784, 0.036487, 0.037598, 0.029404, 0.030651, 0.028305, 0.028171, 0.029398, 0.032454, 0.041900, 0.046900, 0.049130, 0.053426, 0.058014, 0.076237, 0.086762, 0.089495
#*# 	0.125320, 0.098326, 0.065511, 0.062597, 0.057043, 0.053017, 0.048292, 0.049404, 0.043012, 0.042867, 0.039958, 0.043152, 0.035509, 0.036948, 0.040930, 0.036345, 0.049125, 0.065377, 0.086636, 0.104049
#*# 	0.087545, 0.074118, 0.069680, 0.064541, 0.062739, 0.056066, 0.056761, 0.054906, 0.053011, 0.052595, 0.059127, 0.058289, 0.067462, 0.068434, 0.069962, 0.075328, 0.081565, 0.092485, 0.102884, 0.103925
#*# 	0.090923, 0.074676, 0.067461, 0.065935, 0.063294, 0.061766, 0.056023, 0.057599, 0.055235, 0.052876, 0.049539, 0.047596, 0.050646, 0.051348, 0.044259, 0.053706, 0.060514, 0.074288, 0.090792, 0.105355
#*# 	0.095475, 0.084555, 0.072989, 0.068708, 0.068574, 0.066209, 0.071560, 0.065519, 0.067877, 0.062141, 0.074024, 0.073253, 0.079746, 0.081696, 0.088845, 0.093268, 0.094559, 0.099242, 0.109634, 0.123530
#*# 	0.099499, 0.097688, 0.087282, 0.081741, 0.081572, 0.083126, 0.082217, 0.079615, 0.079095, 0.079352, 0.078581, 0.074420, 0.072212, 0.069131, 0.072212, 0.075591, 0.082988, 0.093130, 0.114971, 0.127117
#*# 	0.127529, 0.107304, 0.097162, 0.097813, 0.096377, 0.095606, 0.093878, 0.090279, 0.098589, 0.090279, 0.093789, 0.100540, 0.101191, 0.105742, 0.113180, 0.116216, 0.119259, 0.125469, 0.134422, 0.138843
#*# 	0.141878, 0.124214, 0.115384, 0.110560, 0.106124, 0.105090, 0.098846, 0.092485, 0.093525, 0.096252, 0.098722, 0.093651, 0.089626, 0.086636, 0.086636, 0.088322, 0.100927, 0.106651, 0.125413, 0.148641
#*# 	0.157394, 0.150156, 0.139586, 0.128495, 0.122146, 0.121180, 0.117865, 0.113866, 0.109774, 0.110559, 0.110154, 0.119943, 0.120636, 0.131116, 0.130564, 0.133598, 0.136361, 0.141326, 0.151750, 0.166195
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 204.94
#*# min_y = 10.0
#*# max_y = 209.88000000000005
