# Modified by Simple AF 2025-11-26_10-47-45
# K1
# Printer_size: 220x220x250
# Version: v1.0.25
# CreateDate: 2023/03/21
# Nozzle_mcu: chip: GD32F303CBT6
#             version: CR-K1-MAX-NOZZLE-V1.0.0
# Leveling_mcu: chip: GD32E230F8P6
#             version: CR-K1-MAX-LEVELING-V1.0.0
# mcu: chip: GD32F303RET6
#      version: CR4CU220812S12

[include sensorless.cfg]
[include internal_macros.cfg]

[include useful_macros.cfg]

[include belts_calibration.cfg]

[include start_end.cfg]

[include Line_Purge.cfg]

[include Smart_Park.cfg]

[include fan_control.cfg]

[include client.cfg]

[include quickstart.cfg]

[include cartographer_macro.cfg]

[include cartographer.cfg]

[include custom.cfg]

[mcu]
serial: /dev/ttyS7
baud: 230400
restart_method: command

[mcu nozzle_mcu]
serial: /dev/ttyS1
baud: 230400
restart_method: command

[verify_heater extruder]
[verify_heater heater_bed]
check_gain_time: 120
heating_gain: 1.0
hysteresis: 10

[gcode_arcs]
resolution: 1.0

[stepper_x]
step_pin: PC2
dir_pin: !PB9
enable_pin: !PC3
microsteps: 32
rotation_distance: 72
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_endstop: 229
position_min: -1
position_max: 229
homing_speed: 36
homing_retract_dist:0

[tmc2209 stepper_x]
uart_pin:PA9
interpolate: True
run_current:1.5
sense_resistor: 0.100
stealthchop_threshold: 0
uart_address:3
diag_pin: ^PB12
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 0
# driver_HSTRT: 7
driver_SGTHRS: 65
# hold_current:1.0

[stepper_y]
step_pin: PB8
dir_pin: !PB7
enable_pin: !PC3
microsteps: 32
rotation_distance: 72
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_endstop: -0.5
position_min: -0.5
position_max: 226
homing_speed: 36
homing_retract_dist:0

[tmc2209 stepper_y]
uart_pin:PA10
interpolate: True
run_current:1.5
sense_resistor: 0.100
stealthchop_threshold: 0
uart_address:3
diag_pin: ^PB13
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 0
# driver_HSTRT: 7
driver_SGTHRS: 65
# hold_current:1.0

[stepper_z]
step_pin: PB6
dir_pin: !PB5
enable_pin: !PC3
microsteps: 16
rotation_distance:8
gear_ratio: 64:20
endstop_pin: probe:z_virtual_endstop
position_max: 252
position_min: -5
# position_endstop: 0
homing_retract_dist: 0

[tmc2209 stepper_z]
uart_pin: PA11
uart_address: 3
run_current: 0.8
diag_pin: ^PB14
stealthchop_threshold: 0
sense_resistor: 0.100
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 2
# driver_HSTRT: 2
driver_SGTHRS: 0

[extruder]
max_extrude_only_distance: 1000.0
max_extrude_cross_section: 80
step_pin: nozzle_mcu:PB1
dir_pin: nozzle_mcu:PB0
enable_pin: !nozzle_mcu:PB2
microsteps: 16
rotation_distance: 6.7220
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: nozzle_mcu:PB7
sensor_type: PT1000
sensor_pin: nozzle_mcu:PA0
pressure_advance: 0.035
pressure_advance_smooth_time: 0.040
min_temp: 0
max_temp: 320
# control: pid
# pid_Kp: 25.013
# pid_Ki: 2.566
# pid_Kd: 60.966

[tmc2209 extruder]
uart_pin: nozzle_mcu:PB11
tx_pin: nozzle_mcu:PB10
uart_address: 3
run_current: 0.55
sense_resistor: 0.150
stealthchop_threshold: 0
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 2
# driver_TOFF: 3
# driver_HEND: 0
# driver_HSTRT: 5

[heater_bed]
heater_pin: PB10
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PC4
# control: pid
# pid_kp: 27
# pid_ki: 0.08
# pid_kd: 0
min_temp: 0
max_temp: 115
# control: watermark

[filament_switch_sensor filament_sensor]
pause_on_runout: false
switch_pin: !PC15
runout_gcode: _ON_FILAMENT_RUNOUT
event_delay: 1.5
pause_delay: 0.25

[output_pin LED]
pin:PB0
pwm: True
cycle_time: 0.010
value: 1

[adxl345]
cs_pin: nozzle_mcu:PA4
spi_speed: 5000000
axes_map: x,-z,y
spi_software_sclk_pin: nozzle_mcu:PA5
spi_software_mosi_pin: nozzle_mcu:PA7
spi_software_miso_pin: nozzle_mcu:PA6

[resonance_tester]
accel_chip: adxl345
accel_per_hz: 75
# min_freq: 30
# max_freq: 100
probe_points:
   110,110,10

[printer]
kinematics: corexy
max_velocity: 800
max_accel: 20000
max_z_velocity: 20
square_corner_velocity: 5.0
max_z_accel: 300
# square_corner_max_velocity: 200.0
# max_accel_to_decel: 20000

[exclude_object]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 64.064
#*# pid_ki = 1.014
#*# pid_kd = 1011.413
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 35.434
#*# pid_ki = 11.812
#*# pid_kd = 26.575
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 53.6
#*# shaper_type_y = mzv
#*# shaper_freq_y = 47.6
#*#
#*# [cartographer scan_model default]
#*# coefficients = 1.4568885557408593,1.942043712394671,0.8434026365341584,0.37605692447407096,0.428149708652857,0.3020806631601192,-0.2376256633930451,0.002911818467097563,0.31125903426605506,0.0810872453779946
#*# domain = 3.2060338166954226e-07,3.323883063269578e-07
#*# z_offset = 0
#*# reference_temperature = 39.18
#*#
#*# [cartographer touch_model default]
#*# threshold = 1257
#*# speed = 2.0
#*# z_offset = -0.063
#*#
#*# [axis_twist_compensation]
#*# z_compensations = 0.020651, -0.005142, -0.013478, -0.031026, 0.028995
#*# compensation_start_x = 10.0
#*# compensation_end_x = 210.0
#*#
#*# [cartographer]
#*# z_backlash = 0.00989
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.070749, 0.068574, 0.063416, 0.064221, 0.065011, 0.074413, 0.078394, 0.088484, 0.083882, 0.093675, 0.086408, 0.094331, 0.070844, 0.090226, 0.063824, 0.068860, 0.045728, 0.081132, 0.064033, 0.108083, 0.105691
#*# 	0.054495, 0.044816, 0.036643, 0.031484, 0.026326, 0.030206, 0.031300, 0.029881, 0.033967, 0.029546, 0.024879, 0.024121, 0.023614, 0.020104, 0.010841, 0.001315, 0.004269, 0.016273, 0.031296, 0.046315, 0.050771
#*# 	0.046960, 0.040292, 0.032235, 0.028466, 0.026326, 0.028578, 0.029919, 0.031257, 0.031213, 0.029298, 0.024755, 0.022746, 0.020859, 0.017102, 0.009212, -0.001702, 0.004269, 0.014884, 0.028272, 0.038889, 0.041803
#*# 	0.034974, 0.028425, 0.024658, 0.019625, 0.021793, 0.021167, 0.028290, 0.026623, 0.027966, 0.023289, 0.024631, 0.016857, 0.014852, 0.011218, 0.004695, -0.004717, 0.004512, 0.013244, 0.028277, 0.040281, 0.044838
#*# 	0.028901, 0.020823, 0.018706, 0.010506, 0.014467, 0.012094, 0.016481, 0.014814, 0.016166, 0.011723, 0.012831, 0.006303, 0.003037, 0.002302, -0.001207, -0.010514, 0.001240, 0.004399, 0.022222, 0.028156, 0.035843
#*# 	0.013873, 0.014968, 0.012613, 0.007454, 0.005347, 0.006274, 0.007390, 0.008759, 0.007336, 0.002639, 0.004002, -0.005571, -0.006047, -0.015635, -0.010281, -0.022654, -0.004822, -0.004739, 0.013114, 0.022322, 0.025418
#*# 	0.010703, 0.014722, 0.012613, 0.007454, 0.008389, 0.006023, 0.004607, 0.005974, 0.007092, -0.000395, 0.000721, -0.005822, -0.009332, -0.015635, -0.016100, -0.025695, -0.013691, -0.007788, 0.010317, 0.016220, 0.022232
#*# 	-0.001340, 0.005544, 0.009563, 0.004651, 0.005347, 0.003230, 0.007641, 0.005974, 0.007092, -0.000395, 0.000721, -0.008615, -0.009081, -0.015879, -0.019144, -0.025695, -0.010650, -0.004739, 0.007266, 0.019270, 0.022234
#*# 	0.009416, 0.017771, 0.012613, 0.004405, 0.005347, 0.000189, 0.004607, 0.002940, 0.004056, -0.000395, -0.002062, -0.005571, -0.009081, -0.012591, -0.016100, -0.022654, -0.010650, -0.004739, 0.010317, 0.016220, 0.019293
#*# 	0.015399, 0.011781, 0.009809, 0.002878, -0.000756, -0.002862, 0.000042, 0.001292, 0.001147, -0.001917, -0.005105, -0.007219, -0.010728, -0.015633, -0.019143, -0.022904, -0.012170, -0.001687, 0.007392, 0.017745, 0.020704
#*# 	0.010949, 0.013195, 0.012613, 0.002878, -0.002034, -0.002863, 0.002960, 0.004457, 0.004056, 0.000997, -0.002187, -0.005697, -0.009081, -0.011199, -0.013317, -0.018218, -0.009253, 0.002877, 0.011716, 0.025363, 0.023766
#*# 	0.018466, 0.023865, 0.015413, 0.010506, 0.002296, 0.003230, 0.004607, 0.011786, 0.004306, 0.008451, 0.004002, 0.003274, -0.006047, -0.000716, -0.007254, -0.010764, 0.001240, 0.013244, 0.022222, 0.034471, 0.037367
#*# 	0.025982, 0.020823, 0.024784, 0.016591, 0.008389, 0.006274, 0.010427, 0.011786, 0.010118, 0.011480, 0.009813, 0.009322, 0.003037, 0.005317, -0.001207, 0.001066, 0.007537, 0.022306, 0.028277, 0.040281, 0.040411
#*# 	0.032067, 0.035754, 0.012613, 0.019625, 0.011182, 0.012094, 0.010671, 0.014814, 0.013390, 0.014498, 0.009813, 0.015353, 0.005812, 0.008334, 0.007832, 0.004322, 0.013319, 0.022306, 0.031296, 0.040281, 0.041803
#*# 	0.032067, 0.023865, 0.024784, 0.019625, 0.014467, 0.012338, 0.016481, 0.017833, 0.016166, 0.014498, 0.015846, 0.015353, 0.014851, 0.014351, 0.010841, 0.007331, 0.013319, 0.025323, 0.031296, 0.040281, 0.043445
#*# 	0.039396, 0.041802, 0.018706, 0.028466, 0.023551, 0.024182, 0.025532, 0.026872, 0.025204, 0.023537, 0.021870, 0.021122, 0.020612, 0.020104, 0.016595, 0.010331, 0.019087, 0.025323, 0.034310, 0.043300, 0.049382
#*# 	0.048468, 0.040292, 0.039519, 0.037516, 0.033737, 0.033215, 0.036048, 0.037131, 0.035587, 0.030799, 0.030752, 0.028619, 0.025357, 0.026091, 0.021084, 0.013332, 0.022211, 0.029835, 0.040210, 0.050835, 0.056812
#*# 	0.055999, 0.046325, 0.042667, 0.035999, 0.042627, 0.043582, 0.044781, 0.046099, 0.042938, 0.041148, 0.038112, 0.034602, 0.032585, 0.029075, 0.022581, 0.014705, 0.022087, 0.031092, 0.040335, 0.053719, 0.061336
#*# 	0.057504, 0.047833, 0.039658, 0.046284, 0.044128, 0.041961, 0.046273, 0.044606, 0.045925, 0.041271, 0.039604, 0.033110, 0.032585, 0.026338, 0.022581, 0.010083, 0.022087, 0.028330, 0.040335, 0.055348, 0.065848
#*# 	0.061760, 0.053850, 0.057437, 0.040523, 0.050114, 0.044956, 0.049260, 0.050570, 0.048902, 0.046989, 0.045568, 0.041812, 0.035572, 0.035039, 0.025566, 0.019072, 0.025089, 0.037093, 0.046096, 0.058100, 0.070104
#*# 	0.076720, 0.068574, 0.060431, 0.061244, 0.053099, 0.053904, 0.052237, 0.053549, 0.054606, 0.050214, 0.051517, 0.048007, 0.047218, 0.040988, 0.037233, 0.025043, 0.034060, 0.046064, 0.060803, 0.073060, 0.085064
#*# min_x = 10.0
#*# min_y = 17.0
#*# max_x = 210.0
#*# max_y = 200.0
#*# x_count = 21
#*# y_count = 21
#*# mesh_x_pps = 0
#*# mesh_y_pps = 0
#*# algo = bicubic
#*# tension = 0.2
